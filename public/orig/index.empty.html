<!DOCTYPE html>
<html>
  <head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/javascripts/lumi.js"></script>
    <script src="/javascripts/processing-1.3.6.js"></script>
		<script type="text/javascript" src="jquery.js"></script>

    <script>
			var procInstance = null;

			$(document).ready(function() {

				$('#applyButton').click(function() {
					var target = document.getElementById("outputCanvas");
					var code =$('#codeInput').val().trim();
	
					if(proc != null) {
						proc.exit();
						delete proc;
					}

					proc = new Processing(target, code);	
					debugger;
			});
			


/*
      setTimeout(function() {

        Processing.instances[0].externals.sketch.onFrameEnd = function() { 
          var canv = document.getElementById("pjs");
          var context = canv.getContext("2d");
          var imgd = context.getImageData(0,0,32,32).data;
          var pix = [];
          // Skip Alpha-Channel
          for(var i=0, l=imgd.length; i<l; i+=4) {
            pix.push(imgd[i    ]); 
            pix.push(imgd[i + 1]); 
            pix.push(imgd[i + 2]); 
          }
          lumi.sendFrame(pix);
        };
      }, 5000);
*/ 
    </script>
  </head>
  <body>
    <h1>Sample Page to show lumi-usage</h1>
    <canvas id="outputCanvas"> </canvas>

		<textArea id="codeInput" width="20" height="20">

void setup(){
size(32, 32, P3D); 
background(0);
lights();
}

int r = 0;
int g = 0;
int b = 255;

int cycleStep = 0;

int step = 10;

void draw(){

  if(cycleStep == 0){
    r += step;
    if(r >= 255){
      r = 255;
      cycleStep++;
    }
  }
  
  if(cycleStep == 1){
    b -= step;
    if(b <= 0){
      b = 0;
      cycleStep++;
    }
  }

 if(cycleStep == 2){
    g += step;
    if(g >= 255){
      g = 255;
      cycleStep++;
    }
  }
  
  if(cycleStep == 3){
    r -= step;
    if(r <= 0){
      r = 0;
      cycleStep++;
    }
  }

  if(cycleStep == 4){
    b += step;
    if(b >= 255){
      b = 255;
      cycleStep++;
    }
  }
  
  if(cycleStep == 5){
    g -= step;
    if(g <= 0){
      g = 0;
      cycleStep = 0;
    }
  }
    



  lights();
  background(0);
  strokeWeight(1);
  stroke(r, g, b);
  noFill();
pushMatrix();
translate(width/2, height/2, 0);
  rotateX(frameCount * PI/100);
  rotateY(frameCount * PI/121);
box(width/2.1);
popMatrix();
} 
        	</textArea>
  </body>
</html>
