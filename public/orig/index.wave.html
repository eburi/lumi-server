<!DOCTYPE html>
<html>
  <head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/javascripts/lumi.js"></script>
    <script src="/javascripts/processing-1.3.6.js"></script>

    <script type="application/processing" data-processing-target="pjs">
			// All Examples Written by Casey Reas and Ben Fry

			// unless otherwise stated.
			int xspacing = 2;   // How far apart should each horizontal location be spaced
			int w;              // Width of entire wave
			float yoff = 0.0f;        // 2nd dimension of perlin noise
			float[] yvalues;          // Using an array to store height values for the wave (not entirely necessary)

			void setup() {
				size(32,32);
				frameRate(30);
				colorMode(RGB,255,255,255,100);
				smooth();
				w = width+16;
				yvalues = new float[w/xspacing];
			}

			void draw() {
				background(0);
				calcWave();
				renderWave();
			}

			void calcWave() {
				float dx = 0.05f;
				float dy = 0.01f;
				float amplitude = 40.0f;

				// Increment y ('time')
				yoff += dy;

				//float xoff = 0.0;  // Option #1
				float xoff = yoff; // Option #2

				for (int i = 0; i < yvalues.length; i++) {
					// Using 2D noise function
					//yvalues[i] = (2*noise(xoff,yoff)-1)*amplitude; // Option #1

					// Using 1D noise function
					yvalues[i] = (2*noise(xoff)-1)*amplitude;    // Option #2
					xoff+=dx;
				}
			}

			void renderWave() {
				// A simple way to draw the wave with an ellipse at each location
				for (int x = 0; x < yvalues.length; x++) {
					noStroke();
					fill(255,50);
					ellipseMode(CENTER);
					ellipse(x*xspacing,width/2+yvalues[x],4,4);
				}
			}
    </script>

    <script>
      setTimeout(function() {

        Processing.instances[0].externals.sketch.onFrameEnd = function() { 
          var canv = document.getElementById("pjs");
          var context = canv.getContext("2d");
          var imgd = context.getImageData(0,0,32,32).data;
          var pix = [];
          // Skip Alpha-Channel
          for(var i=0, l=imgd.length; i<l; i+=4) {
            pix.push(imgd[i    ]); 
            pix.push(imgd[i + 1]); 
            pix.push(imgd[i + 2]); 
          }
          lumi.sendFrame(pix);
        };
      }, 5000); 
    </script>
  </head>
  <body>
    <h1>HELLO</h1>
    <canvas id="pjs"> </canvas>
  </body>
</html>
