<!DOCTYPE html>
<html>
  <head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/javascripts/lumi.js"></script>
    <script src="/javascripts/processing-1.3.6.js"></script>

    <script type="application/processing" data-processing-target="pjs">

		// Sketch Code
int t=0;
float r1=random(-0.2,0.2);
float r2=random(-0.2,0.2);
float r3=random(-0.2,0.2);
float g1=random(-0.2,0.2);
float g2=random(-0.2,0.2);
float g3=random(-0.2,0.2);
float b1=random(-0.2,0.2);
float b2=random(-0.2,0.2);
float b3=random(-0.2,0.2);

void setup(){
  size(32,32);
  background(0);
}
  void draw(){
  ++t;
  for (int i=0; i<=width; ++i) {
    int red=255*0.25*(2+sin(i*r1)*0.5+sin((i-t)*r2)*0.5+cos(t*r3-1.4));
    int green=255*0.25*(2+sin(i*g1)*0.5+sin((i-t)*g2)*0.5+cos(t*g3-1.1));
    int blue=255*0.25*(2+sin(i*b1)*0.5+sin((i-t)*b2)*0.5+cos(t*b3-0.5));
    stroke(red,green,blue);
    line(i,0,i,height);
  }
}

    </script>

    <script>
      setTimeout(function() {

        Processing.instances[0].externals.sketch.onFrameEnd = function() { 
          var canv = document.getElementById("pjs");
          var context = canv.getContext("2d");
          var imgd = context.getImageData(0,0,32,32).data;
          var pix = [];
          // Skip Alpha-Channel
          for(var i=0, l=imgd.length; i<l; i+=4) {
            pix.push(imgd[i    ]); 
            pix.push(imgd[i + 1]); 
            pix.push(imgd[i + 2]); 
          }
          lumi.sendFrame(pix);
        };
      }, 5000); 
    </script>
  </head>
  <body>
    <h1>HELLO</h1>
    <canvas id="pjs"> </canvas>
  </body>
</html>
